# Logstash 配置文件
# 用于接收 hi-go 应用的日志并转发到 Elasticsearch

input {
  # TCP 输入 - 接收应用通过 TCP 发送的 JSON 日志
  tcp {
    port => 5000
    codec => json_lines
  }
}

filter {
  # 处理时间字段
  if [ts] {
    date {
      match => ["ts", "ISO8601"]
      target => "@timestamp"
      remove_field => ["ts"]
    }
  }

  # 添加应用标识
  mutate {
    add_field => {
      "app" => "hi-go"
    }
  }

  # 如果有级别字段，转换为大写
  if [level] {
    mutate {
      uppercase => ["level"]
    }
  }
}

output {
  # 输出到 Elasticsearch
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "hi-go-logs-%{+YYYY.MM.dd}"
  }

  # 调试输出（可选）
  # stdout {
  #   codec => rubydebug
  # }
}
